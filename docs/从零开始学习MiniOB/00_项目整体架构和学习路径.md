# MiniOB从零开始学习指南 - 项目整体架构

## 🎯 学习目标

作为C++小白，通过学习MiniOB项目，你将掌握：
1. **数据库系统的核心原理**
2. **现代C++编程技术**
3. **大型项目的架构设计**
4. **系统编程的实践经验**

## 📁 项目整体结构

### 1. 顶层目录结构
```
OBZen-zhanghao-2024/
├── src/                    # 核心源代码
├── test/                   # 测试用例
├── docs/                   # 文档
├── build.sh               # 编译脚本
├── CMakeLists.txt         # 构建配置
└── README.md              # 项目说明
```

### 2. 核心源代码结构 (src/)
```
src/
├── observer/              # 数据库服务器核心
│   ├── main.cpp          # 程序入口
│   ├── sql/              # SQL处理模块
│   ├── storage/          # 存储引擎
│   ├── net/              # 网络通信
│   ├── session/          # 会话管理
│   └── catalog/          # 元数据管理
├── obclient/             # 数据库客户端
├── common/               # 公共组件
└── oblsm/                # LSM存储引擎
```

## 🏗️ 数据库系统架构

### 1. 整体架构图
```
┌─────────────────────────────────────────────────────────┐
│                    客户端 (obclient)                      │
└─────────────────────┬───────────────────────────────────┘
                      │ TCP/IP
┌─────────────────────┴───────────────────────────────────┐
│                 网络层 (net/)                           │
├─────────────────────────────────────────────────────────┤
│                 会话层 (session/)                       │
├─────────────────────────────────────────────────────────┤
│                 SQL处理层 (sql/)                        │
│  ┌─────────────┬─────────────┬─────────────┬────────────┤
│  │   Parser    │  Optimizer  │  Executor   │ Expression │
│  │  (解析器)   │  (优化器)   │  (执行器)   │ (表达式)   │
├──┴─────────────┴─────────────┴─────────────┴────────────┤
│                存储引擎 (storage/)                       │
│  ┌─────────────┬─────────────┬─────────────┬────────────┤
│  │    Table    │    Index    │   Record    │   Buffer   │
│  │   (表管理)   │  (索引管理)  │  (记录管理)  │  (缓冲池)   │
├──┴─────────────┴─────────────┴─────────────┴────────────┤
│                文件系统 / 磁盘                           │
└─────────────────────────────────────────────────────────┘
```

### 2. 数据流向
```
SQL查询 → 网络接收 → 会话管理 → SQL解析 → 查询优化 → 执行计划 → 存储访问 → 结果返回
```

## 🔍 核心模块详解

### 1. 网络层 (net/)
**作用：** 处理客户端连接和通信
```cpp
// C++语法学习点：类的基本结构
class Server {
private:
    int port_;              // 成员变量（私有）
    bool running_;
    
public:                     // 公有接口
    Server(int port);       // 构造函数
    ~Server();              // 析构函数
    
    void start();           // 成员函数
    void stop();
};
```

### 2. 会话层 (session/)
**作用：** 管理客户端会话状态
```cpp
// C++语法学习点：智能指针和容器
class SessionManager {
private:
    std::vector<std::unique_ptr<Session>> sessions_;  // 智能指针容器
    
public:
    void add_session(std::unique_ptr<Session> session);
    void remove_session(int session_id);
};
```

### 3. SQL处理层 (sql/)
**核心子模块：**
- **Parser（解析器）：** 将SQL文本转换为语法树
- **Optimizer（优化器）：** 优化查询计划
- **Executor（执行器）：** 执行查询计划
- **Expression（表达式）：** 处理各种计算表达式

### 4. 存储引擎 (storage/)
**核心子模块：**
- **Table（表管理）：** 管理数据表结构和数据
- **Index（索引管理）：** 提供快速数据检索
- **Record（记录管理）：** 管理数据行的存储和访问
- **Buffer（缓冲池）：** 内存中的数据页缓存

## 🎓 学习路径建议

### 阶段一：基础准备（1-2周）
1. **C++基础语法复习**
   - 类和对象
   - 指针和引用
   - 智能指针
   - 容器（vector, map等）
   - 继承和多态

2. **项目环境搭建**
   - 编译项目
   - 运行测试
   - 理解构建系统

### 阶段二：核心概念理解（2-3周）
1. **数据库基础概念**
   - 表、行、列
   - 索引原理
   - 事务概念
   - SQL语句类型

2. **项目整体架构**
   - 各模块职责
   - 数据流向
   - 接口设计

### 阶段三：模块深入学习（4-6周）
1. **存储引擎**（最基础，先学）
2. **SQL解析器**（理解SQL如何变成内部表示）
3. **表达式系统**（已经学过了！）
4. **查询执行器**（理解查询如何执行）
5. **优化器**（最复杂，最后学）

### 阶段四：实践和扩展（2-4周）
1. **添加新功能**
2. **性能优化**
3. **代码调试**
4. **测试编写**

## 📚 学习资源

### 1. 项目内文档
- `docs/` 目录下的设计文档
- 代码注释
- 测试用例

### 2. 推荐学习顺序
```
1. main.cpp          # 程序入口，理解启动流程
2. storage/table/    # 表管理，理解数据如何存储
3. sql/parser/       # SQL解析，理解SQL如何解析
4. sql/expr/         # 表达式系统（已学习）
5. sql/executor/     # 查询执行，理解查询如何执行
6. sql/optimizer/    # 查询优化，理解优化原理
```

## 🛠️ 开发环境准备

### 1. 编译项目
```bash
cd /home/chris/OBZen-zhanghao-2024
./build.sh
```

### 2. 运行服务器
```bash
./build/bin/observer -f etc/observer.ini
```

### 3. 运行客户端
```bash
./build/bin/obclient
```

### 4. 运行测试
```bash
cd build
make test
```

## 🎯 第一个学习目标

**建议从 `main.cpp` 开始学习：**
1. 理解程序如何启动
2. 各个模块如何初始化
3. 主要的数据结构是什么
4. 程序的生命周期

这将帮助你建立对整个系统的宏观理解！

## 🤝 学习建议

1. **循序渐进：** 不要急于理解所有细节，先建立整体概念
2. **动手实践：** 多编译、多运行、多调试
3. **做笔记：** 记录重要概念和自己的理解
4. **提问题：** 遇到不懂的C++语法或概念及时问
5. **看测试：** 测试用例是很好的学习材料

准备好了吗？让我们从项目的入口开始学习吧！
