-- echo ===========================================
-- echo 综合功能验证测试
-- echo ===========================================

-- echo ===== 初始化测试数据 =====
CREATE TABLE t1(id int, name char(10), age int);
CREATE TABLE t2(id int, score int);
CREATE TABLE t3(id int, grade char(5));

INSERT INTO t1 VALUES (1, 'Alice', 20);
INSERT INTO t1 VALUES (2, 'Bob', 22);
INSERT INTO t1 VALUES (3, 'Charlie', 21);
INSERT INTO t1 VALUES (4, 'David', 23);
INSERT INTO t1 VALUES (5, 'Eve', 20);

INSERT INTO t2 VALUES (1, 85);
INSERT INTO t2 VALUES (2, 90);
INSERT INTO t2 VALUES (3, 78);
INSERT INTO t2 VALUES (6, 95);

INSERT INTO t3 VALUES (1, 'A');
INSERT INTO t3 VALUES (2, 'B');
INSERT INTO t3 VALUES (3, 'C');

-- echo ===== 测试1: INNER JOIN 两表 =====
-- sort select * from t1 inner join t2 on t1.id = t2.id;

-- echo ===== 测试2: INNER JOIN 三表 =====
-- sort select t1.name, t2.score, t3.grade from t1 inner join t2 on t1.id = t2.id inner join t3 on t2.id = t3.id;

-- echo ===== 测试3: INNER JOIN 多条ON条件 =====
-- sort select * from t1 inner join t2 on t1.id = t2.id and t2.score > 80;

-- echo ===== 测试4: INNER JOIN 复杂条件 =====
-- sort select * from t1 inner join t2 on t1.id = t2.id and t1.age > 20 and t2.score > 85;

-- echo ===== 测试5: IN (value_list) =====
-- sort select * from t1 where id in (1, 3, 5);

-- echo ===== 测试6: NOT IN (value_list) =====
-- sort select * from t1 where id not in (2, 4);

-- echo ===== 测试7: IN (SELECT...) 子查询 =====
-- sort select * from t1 where id in (select id from t2);

-- echo ===== 测试8: NOT IN (SELECT...) 子查询 =====
-- sort select * from t1 where id not in (select id from t2 where score < 85);

-- echo ===== 测试9: EXISTS 存在性检查 =====
-- sort select * from t1 where exists (select * from t2 where t2.id = t1.id);

-- echo ===== 测试10: NOT EXISTS 不存在性检查 =====
-- sort select * from t1 where not exists (select * from t2 where t2.id = t1.id and t2.score > 90);

-- echo ===== 测试11: 标量子查询 AVG =====
-- sort select * from t1 where age > (select avg(age) from t1);

-- echo ===== 测试12: 子查询 AVG 比较 =====
-- sort select * from t2 where score > (select avg(score) from t2);

-- echo ===== 测试13: 子查询返回多行 IN =====
-- sort select * from t1 where id in (select id from t2 where score >= 85);

-- echo ===== 测试14: 子查询 MAX =====
-- sort select * from t1 where age < (select max(age) from t1);

-- echo ===== 测试15: 子查询 MIN =====
-- sort select * from t2 where score > (select min(score) from t2);

-- echo ===== 测试16: 子查询 SUM =====
-- sort select * from t2 where score < (select sum(score) from t2 where id < 3);

-- echo ===== 测试17: 非关联子查询 =====
-- sort select * from t1 where id in (select id from t2);

-- echo ===== 测试18: 表达式 + 子查询 =====
-- sort select * from t1 where age * 2 > (select max(age) from t1) + 10;

-- echo ===== 测试19: JOIN + 子查询组合 =====
-- sort select * from t1 inner join t2 on t1.id = t2.id where t2.score > (select avg(score) from t2);

-- echo ===== 测试20: 复杂组合测试 =====
-- sort select t1.name, t2.score from t1 inner join t2 on t1.id = t2.id and t1.age > 20 where t2.score in (select score from t2 where score >= 85) and exists (select * from t3 where t3.id = t1.id);

-- echo ===== 测试21: IN 值列表表达式 =====
-- sort select * from t1 where age in (20, 21, 22);

-- echo ===== 测试22: 表达式计算 =====
-- sort select * from t1 where age * 2 > 40 and age > 20;

-- echo ===== 测试23: COUNT 聚合 =====
select count(*) from t1;

-- echo ===== 测试24: 多聚合函数 =====
select count(*), sum(score), avg(score), max(score), min(score) from t2;

-- echo ===== 测试25: IN 空结果 =====
-- sort select * from t1 where id in (select id from t2 where score > 100);

-- echo ===== 测试26: NOT IN 空结果 =====
-- sort select * from t1 where id not in (select id from t2 where score > 100);

-- echo ===== 清理 =====
DROP TABLE t1;
DROP TABLE t2;
DROP TABLE t3;

